
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Blog Bom!!BO!">
    <title>Sliding Time Window - Blog Bom!!BO!</title>
    <meta name="author" content="Eddie Lee">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Eddie Lee","sameAs":["https://github.com/RadianceL"],"image":"eddie-personal.jpg"},"articleBody":"滑动时间块记录单位时间内通过次数\n起因想要完成一个个人轻量级微服务框架，负载均衡和接口安全都需要一个这样的工具来统计访问频率，那么就选择了一种比较传统的方式来实现，其他博客中有提供一些方式，但设计较为简单，不能满足我的需求，所以再起炉灶\n滑动窗口概念上非常简单，就是给定一个数据结构列表，例如20个窗口，步长固定为1，长度为10，当index为11时，该窗口范围为[1-11]\n代码实现首先思考一下算法，我们大概需要几个参数【窗口个数、每个时间片时长、队列长度、每个时间片内允许授权个数（可选）】\n123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * 时间窗滑块 * since 2019/12/8 * * @author eddie */public class TimeWindowSliding &#123;    /** 队列的总长度  */    private volatile int timeSliceSize;    /** 每个时间片的时长，以毫秒为单位 */    private volatile int timeMillisPerSlice;    /** 当前所使用的时间片位置 */    private AtomicInteger cursor = new AtomicInteger(0);    /** 在一个完整窗口期内允许通过的最大阈值 */    private int threshold;\t/** 窗口个数 */    private int windowSize;    /** 最小每个时间片的时长，以毫秒为单位 */    private static final int MIN_TIME_MILLIS_PER_SLICE = 50;    /** 最小窗口数量 */    private static final int DEFAULT_WINDOW_SIZE = 5;    /** 数据存储 */    private TimeWindowSlidingDataSource timeWindowSlidingDataSource;    public TimeWindowSliding(TimeWindowSlidingDataSource timeWindowSlidingDataSource, int windowSize, int timeMillisPerSlice, int threshold)&#123;        this.timeWindowSlidingDataSource = timeWindowSlidingDataSource;        this.timeMillisPerSlice = timeMillisPerSlice;        this.threshold = threshold;        /* 低于一定窗口个数会丢失精准度 */        this.windowSize = Math.max(windowSize, DEFAULT_WINDOW_SIZE);        /* 保证每个时间窗至少有2个窗口存储 不会重叠 */        this.timeSliceSize = this.windowSize * 2 + 1;        /* 可以忽略这个操作 数据存储结构中定义的生命周期函数 如果接口有实现会调用 没有实现走默认实现直接return */        timeWindowSlidingDataSource.initTimeSlices();        /* 初始化参数校验 */        this.verifier();    &#125;\n初始化函数中包含了一个TimeWindowSlidingDataSource，看下这个接口的定义123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100/** * 时间分配数据源 * since 2019/12/8 * * @author eddie */public interface TimeWindowSlidingDataSource &#123;    /**     * 记录通过记录     * @param timeSlices    时间分片     * @param recordKey     记录参数     * @throws TimeWindowSlidingDataSourceException     时间分片数据源操作异常     */    void allocAdoptRecord(int timeSlices, String recordKey) throws TimeWindowSlidingDataSourceException;    /**     * 获取&lt;recordKey&gt;通过次数     * @param timeSlices    时间分片     * @param recordKey     记录参数     * @return     * @throws TimeWindowSlidingDataSourceException     */    int getAllocAdoptRecordTimes(int timeSlices, String recordKey) throws TimeWindowSlidingDataSourceException;    /**     * 将fromIndex~toIndex之间的时间片计数清零     * @param fromIndex     起始索引     * @param toIndex       结束索引     * @param totalLength   窗口数量     * @throws TimeWindowSlidingDataSourceException     时间分片数据源操作异常     */    void clearBetween(int fromIndex, int toIndex, int totalLength) throws TimeWindowSlidingDataSourceException;    /**     * 将index时间片计数清零     * @param index         索引     * @throws TimeWindowSlidingDataSourceException     */    void clearSingle(int index) throws TimeWindowSlidingDataSourceException;    /**     * 根据需求 可不使用该函数 该函数会在初始化阶段调用一次     * @throws TimeWindowSlidingDataSourceException     时间分片数据源操作异常     */    default void initTimeSlices() throws TimeWindowSlidingDataSourceException &#123;&#125;    static TimeWindowSlidingDataSource defaultDataSource() &#123;        return new TimeWindowSlidingDataSource() &#123;            private Map&lt;String, Map&lt;String,Integer&gt;&gt; timeWindowSlidingMap = new ConcurrentHashMap&lt;&gt;(16);            @Override            public void allocAdoptRecord(int timeSlices, String recordKey) throws TimeWindowSlidingDataSourceException &#123;                Map&lt;String, Integer&gt; timeSlicesMap = timeWindowSlidingMap.get(String.valueOf(timeSlices));                if (Objects.isNull(timeSlicesMap))&#123;                    timeSlicesMap = new ConcurrentHashMap&lt;&gt;(16);                    timeWindowSlidingMap.put(String.valueOf(timeSlices), timeSlicesMap);                &#125;                Integer adoptTimes = timeSlicesMap.get(recordKey);                int nextTimes = adoptTimes == null ? 0 : adoptTimes;                timeSlicesMap.put(recordKey, ++ nextTimes);            &#125;            @Override            public int getAllocAdoptRecordTimes(int timeSlices, String recordKey) throws TimeWindowSlidingDataSourceException &#123;                Map&lt;String, Integer&gt; timeSlicesMap = timeWindowSlidingMap.get(String.valueOf(timeSlices));                if (Objects.isNull(timeSlicesMap))&#123;                    return 0;                &#125;                Integer recordTimes = timeSlicesMap.get(recordKey);                return Objects.isNull(recordTimes) ? 0 : recordTimes;            &#125;            @Override            public void clearBetween(int fromIndex, int toIndex, int totalLength) throws TimeWindowSlidingDataSourceException &#123;                if (fromIndex &gt;= toIndex)&#123;                    toIndex += totalLength;                &#125;                while (fromIndex &lt;= toIndex) &#123;                    Map&lt;String, Integer&gt; timeWindowSlidingScopeMap = timeWindowSlidingMap.get(String.valueOf(fromIndex));                    if (!Objects.isNull(timeWindowSlidingScopeMap) &amp;&amp; timeWindowSlidingScopeMap.size() &gt; 0)&#123;                        timeWindowSlidingScopeMap.clear();                    &#125;                    fromIndex++;                &#125;            &#125;            @Override            public void clearSingle(int index) throws TimeWindowSlidingDataSourceException &#123;                Map&lt;String, Integer&gt; timeWindowSlidingScopeMap = timeWindowSlidingMap.get(String.valueOf(index));                if (!Objects.isNull(timeWindowSlidingScopeMap) &amp;&amp; timeWindowSlidingScopeMap.size() &gt; 0)&#123;                    timeWindowSlidingScopeMap.clear();                &#125;            &#125;        &#125;;    &#125;&#125;\n这个类其实就是一个约定，默认提供了一个基于HashMap的实现，我需要统计单用户访问接口频率，所以，数据结构采用HashMap，也就是说相当于有一个List&lt;Map&lt;String,Integer&gt;&gt;的结构，但因为习惯问题，我才用了Map&lt;String, Map&lt;String,Integer&gt;&gt; 的结构。\n但这个无所谓，因为出于场景考虑，大概率是要支持分布式的，那就需要引入redis，可这是一个工具包，因为这个工具就引入一个redis的包不太划算，所以定义了这么一个约定接口，不管你用什么存储，memchche，redis，mangodb，只要实现了这几个方法，传入工具中就能完成对应的功能，算是一个变形的策略模式\n这些参数都初始化好之后，看下算法的部分，提供三个接口：1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283/** * 判断是否允许进行访问，未超过阈值的话才会对某个时间片+1 */public boolean allowLimitTimes(String key) &#123;    int index = locationIndex();    int sum = 0;    // cursor不等于index，将cursor设置为index    int oldCursor = cursor.getAndSet(index);    if (oldCursor != index) &#123;        // 清零，访问量不大时会有时间片跳跃的情况        clearBetween(oldCursor, index);    &#125;    for (int i = 1; i &lt; timeSliceSize; i++) &#123;        sum += timeWindowSlidingDataSource.getAllocAdoptRecordTimes(i, key);    &#125;    // 阈值判断    if (sum &lt;= threshold) &#123;        // 未超过阈值才+1        this.timeWindowSlidingDataSource.allocAdoptRecord(index, key);        return true;    &#125;    return false;&#125;/** * 返回平均每秒访问次数 */public int allowNotLimitPerMin(String key) &#123;    int index = locationIndex();    int sum = 0;    int nextIndex = index + 1;    this.timeWindowSlidingDataSource.clearSingle(nextIndex);    int from = index, to  = index;    if (index &lt; windowSize) &#123;        from += windowSize + 1;        to += 2 * windowSize;    &#125;else &#123;        from = index - windowSize + 1;    &#125;    while (from &lt;= to)&#123;        int targetIndex = from;        if (from &gt;= timeSliceSize) &#123;            targetIndex = from - 2 * windowSize;        &#125;        sum += timeWindowSlidingDataSource.getAllocAdoptRecordTimes(targetIndex, key);        from ++;    &#125;    this.timeWindowSlidingDataSource.allocAdoptRecord(index, key);    return (sum + 1) / windowSize;&#125;/** * 返回每秒访问次数 */public int allowNotLimit(String key) &#123;    int index = locationIndex();    int sum = 0;    // cursor不等于index，将cursor设置为index    int oldCursor = cursor.getAndSet(index);    if (oldCursor != index) &#123;        // 清零，访问量不大时会有时间片跳跃的情况        clearBetween(oldCursor, index);    &#125;    for (int i = 0; i &lt;= timeSliceSize; i++) &#123;        sum += timeWindowSlidingDataSource.getAllocAdoptRecordTimes(i, key);    &#125;    this.timeWindowSlidingDataSource.allocAdoptRecord(index, key);    return sum + 1;&#125;/** * &lt;p&gt;将fromIndex~toIndex之间的时间片计数都清零 * &lt;p&gt;极端情况下，当循环队列已经走了超过1个timeSliceSize以上，这里的清零并不能如期望的进行 */private void clearBetween(int fromIndex, int toIndex) &#123;    this.timeWindowSlidingDataSource.clearBetween(fromIndex, toIndex, timeSliceSize);&#125;private int locationIndex() &#123;    long time = System.currentTimeMillis();    return (int) ((time / timeMillisPerSlice) % timeSliceSize);&#125;\n演示结果就不给大家展示了，刚把一大堆log去掉，然后滑动窗口的这个算法我有点拎不清，如果有更好的办法欢迎给我留言，或者github协作，该项目github地址，对应实现在com.el.common.time.sliding包下\n另外感谢博主:  tianyaleixiaowu提供的基础思路\n","dateCreated":"2019-12-15T10:06:23+08:00","dateModified":"2020-01-09T22:26:54+08:00","datePublished":"2019-12-15T10:06:23+08:00","description":"滑动时间块记录单位时间内通过次数","headline":"Sliding Time Window","image":["https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=960265520,2932106354&fm=27&gp=0.jpg","http://old.bz55.com/uploads/allimg/150719/139-150GZZ039.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://radiancel.github.io/2019/12/15/Sliding-Time-Window/"},"publisher":{"@type":"Organization","name":"Eddie Lee","sameAs":["https://github.com/RadianceL"],"image":"eddie-personal.jpg","logo":{"@type":"ImageObject","url":"eddie-personal.jpg"}},"url":"https://radiancel.github.io/2019/12/15/Sliding-Time-Window/","keywords":"Java","thumbnailUrl":"https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=960265520,2932106354&fm=27&gp=0.jpg"}</script>
    <meta name="description" content="滑动时间块记录单位时间内通过次数">
<meta name="keywords" content="Java">
<meta property="og:type" content="blog">
<meta property="og:title" content="Sliding Time Window">
<meta property="og:url" content="https://radiancel.github.io/2019/12/15/Sliding-Time-Window/index.html">
<meta property="og:site_name" content="Blog Bom!!BO!">
<meta property="og:description" content="滑动时间块记录单位时间内通过次数">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2019121512001485.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1N1bW1lcmRyZWFtMTk5Ng==,size_16,color_FFFFFF,t_70">
<meta property="og:updated_time" content="2020-01-09T14:26:54.885Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sliding Time Window">
<meta name="twitter:description" content="滑动时间块记录单位时间内通过次数">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/2019121512001485.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1N1bW1lcmRyZWFtMTk5Ng==,size_16,color_FFFFFF,t_70">
    
    
        
    
    
        <meta property="og:image" content="https://radiancel.github.io/assets/images/eddie-personal.jpg"/>
    
    
        <meta property="og:image" content="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=960265520,2932106354&amp;fm=27&amp;gp=0.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=960265520,2932106354&amp;fm=27&amp;gp=0.jpg" />
    
    
        <meta property="og:image" content="http://old.bz55.com/uploads/allimg/150719/139-150GZZ039.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://old.bz55.com/uploads/allimg/150719/139-150GZZ039.jpg" />
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-c4ozcsklz4kht2pebhp44xorvyverh23toayhn7i6ubrpyedak24hv1v0hyd.min.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Blog Bom!!BO!</a>
    </div>
    
        
            <a class="header-right-picture " href="#about">
        
        
            <img class="header-picture" src="/assets/images/eddie-personal.jpg" alt="Author&#39;s picture">
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/eddie-personal.jpg" alt="Author&#39;s picture">
                </a>
                <h4 class="sidebar-profile-name">Eddie Lee</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/ " title="Home">
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-categories" title="Categories">
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" title="Tags">
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-archives" title="Archives">
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" title="About">
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/RadianceL" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-left
                    " style="background-image:url('http://old.bz55.com/uploads/allimg/150719/139-150GZZ039.jpg');" data-behavior="4">
            
                <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Sliding Time Window
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-12-15T10:06:23+08:00">
	
		    Dec 15, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Java/">Java</a>


    
</div>

    
</div>

            
        </div>

            <div id="main" data-behavior="4"
                 class="hasCover
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>滑动时间块记录单位时间内通过次数<br><a id="more"></a></p>
<h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>想要完成一个个人轻量级微服务框架，负载均衡和接口安全都需要一个这样的工具来统计访问频率，那么就选择了一种比较传统的方式来实现，其他博客中有提供一些方式，但设计较为简单，不能满足我的需求，所以再起炉灶</p>
<h3 id="滑动窗口"><a href="#滑动窗口" class="headerlink" title="滑动窗口"></a>滑动窗口</h3><p>概念上非常简单，就是给定一个数据结构列表，例如20个窗口，步长固定为1，长度为10，当index为<code>11</code>时，该窗口范围为<code>[1-11]</code><br><img src="https://img-blog.csdnimg.cn/2019121512001485.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1N1bW1lcmRyZWFtMTk5Ng==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>首先思考一下算法，我们大概需要几个参数【窗口个数、每个时间片时长、队列长度、每个时间片内允许授权个数（可选）】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间窗滑块</span></span><br><span class="line"><span class="comment"> * since 2019/12/8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> eddie</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeWindowSliding</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 队列的总长度  */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> timeSliceSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 每个时间片的时长，以毫秒为单位 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> timeMillisPerSlice;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 当前所使用的时间片位置 */</span></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger cursor = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 在一个完整窗口期内允许通过的最大阈值 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 窗口个数 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> windowSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 最小每个时间片的时长，以毫秒为单位 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TIME_MILLIS_PER_SLICE = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 最小窗口数量 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_WINDOW_SIZE = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 数据存储 */</span></span><br><span class="line">    <span class="keyword">private</span> TimeWindowSlidingDataSource timeWindowSlidingDataSource;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TimeWindowSliding</span><span class="params">(TimeWindowSlidingDataSource timeWindowSlidingDataSource, <span class="keyword">int</span> windowSize, <span class="keyword">int</span> timeMillisPerSlice, <span class="keyword">int</span> threshold)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.timeWindowSlidingDataSource = timeWindowSlidingDataSource;</span><br><span class="line">        <span class="keyword">this</span>.timeMillisPerSlice = timeMillisPerSlice;</span><br><span class="line">        <span class="keyword">this</span>.threshold = threshold;</span><br><span class="line">        <span class="comment">/* 低于一定窗口个数会丢失精准度 */</span></span><br><span class="line">        <span class="keyword">this</span>.windowSize = Math.max(windowSize, DEFAULT_WINDOW_SIZE);</span><br><span class="line">        <span class="comment">/* 保证每个时间窗至少有2个窗口存储 不会重叠 */</span></span><br><span class="line">        <span class="keyword">this</span>.timeSliceSize = <span class="keyword">this</span>.windowSize * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">/* 可以忽略这个操作 数据存储结构中定义的生命周期函数 如果接口有实现会调用 没有实现走默认实现直接return */</span></span><br><span class="line">        timeWindowSlidingDataSource.initTimeSlices();</span><br><span class="line">        <span class="comment">/* 初始化参数校验 */</span></span><br><span class="line">        <span class="keyword">this</span>.verifier();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>初始化函数中包含了一个<code>TimeWindowSlidingDataSource</code>，看下这个接口的定义<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间分配数据源</span></span><br><span class="line"><span class="comment"> * since 2019/12/8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> eddie</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TimeWindowSlidingDataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记录通过记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeSlices    时间分片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> recordKey     记录参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> TimeWindowSlidingDataSourceException     时间分片数据源操作异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">allocAdoptRecord</span><span class="params">(<span class="keyword">int</span> timeSlices, String recordKey)</span> <span class="keyword">throws</span> TimeWindowSlidingDataSourceException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取&lt;recordKey&gt;通过次数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeSlices    时间分片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> recordKey     记录参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> TimeWindowSlidingDataSourceException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getAllocAdoptRecordTimes</span><span class="params">(<span class="keyword">int</span> timeSlices, String recordKey)</span> <span class="keyword">throws</span> TimeWindowSlidingDataSourceException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将fromIndex~toIndex之间的时间片计数清零</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fromIndex     起始索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toIndex       结束索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> totalLength   窗口数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> TimeWindowSlidingDataSourceException     时间分片数据源操作异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clearBetween</span><span class="params">(<span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex, <span class="keyword">int</span> totalLength)</span> <span class="keyword">throws</span> TimeWindowSlidingDataSourceException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将index时间片计数清零</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index         索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> TimeWindowSlidingDataSourceException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clearSingle</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> TimeWindowSlidingDataSourceException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据需求 可不使用该函数 该函数会在初始化阶段调用一次</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> TimeWindowSlidingDataSourceException     时间分片数据源操作异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">initTimeSlices</span><span class="params">()</span> <span class="keyword">throws</span> TimeWindowSlidingDataSourceException </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> TimeWindowSlidingDataSource <span class="title">defaultDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TimeWindowSlidingDataSource() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> Map&lt;String, Map&lt;String,Integer&gt;&gt; timeWindowSlidingMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">allocAdoptRecord</span><span class="params">(<span class="keyword">int</span> timeSlices, String recordKey)</span> <span class="keyword">throws</span> TimeWindowSlidingDataSourceException </span>&#123;</span><br><span class="line">                Map&lt;String, Integer&gt; timeSlicesMap = timeWindowSlidingMap.get(String.valueOf(timeSlices));</span><br><span class="line">                <span class="keyword">if</span> (Objects.isNull(timeSlicesMap))&#123;</span><br><span class="line">                    timeSlicesMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">                    timeWindowSlidingMap.put(String.valueOf(timeSlices), timeSlicesMap);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Integer adoptTimes = timeSlicesMap.get(recordKey);</span><br><span class="line">                <span class="keyword">int</span> nextTimes = adoptTimes == <span class="keyword">null</span> ? <span class="number">0</span> : adoptTimes;</span><br><span class="line">                timeSlicesMap.put(recordKey, ++ nextTimes);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAllocAdoptRecordTimes</span><span class="params">(<span class="keyword">int</span> timeSlices, String recordKey)</span> <span class="keyword">throws</span> TimeWindowSlidingDataSourceException </span>&#123;</span><br><span class="line">                Map&lt;String, Integer&gt; timeSlicesMap = timeWindowSlidingMap.get(String.valueOf(timeSlices));</span><br><span class="line">                <span class="keyword">if</span> (Objects.isNull(timeSlicesMap))&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Integer recordTimes = timeSlicesMap.get(recordKey);</span><br><span class="line">                <span class="keyword">return</span> Objects.isNull(recordTimes) ? <span class="number">0</span> : recordTimes;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearBetween</span><span class="params">(<span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex, <span class="keyword">int</span> totalLength)</span> <span class="keyword">throws</span> TimeWindowSlidingDataSourceException </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (fromIndex &gt;= toIndex)&#123;</span><br><span class="line">                    toIndex += totalLength;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span> (fromIndex &lt;= toIndex) &#123;</span><br><span class="line">                    Map&lt;String, Integer&gt; timeWindowSlidingScopeMap = timeWindowSlidingMap.get(String.valueOf(fromIndex));</span><br><span class="line">                    <span class="keyword">if</span> (!Objects.isNull(timeWindowSlidingScopeMap) &amp;&amp; timeWindowSlidingScopeMap.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                        timeWindowSlidingScopeMap.clear();</span><br><span class="line">                    &#125;</span><br><span class="line">                    fromIndex++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearSingle</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> TimeWindowSlidingDataSourceException </span>&#123;</span><br><span class="line">                Map&lt;String, Integer&gt; timeWindowSlidingScopeMap = timeWindowSlidingMap.get(String.valueOf(index));</span><br><span class="line">                <span class="keyword">if</span> (!Objects.isNull(timeWindowSlidingScopeMap) &amp;&amp; timeWindowSlidingScopeMap.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                    timeWindowSlidingScopeMap.clear();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个类其实就是一个约定，默认提供了一个基于<code>HashMap</code>的实现，我需要统计单用户访问接口频率，所以，数据结构采用HashMap，也就是说相当于有一个List&lt;Map&lt;String,Integer&gt;&gt;的结构，但因为习惯问题，我才用了<code>Map&lt;String, Map&lt;String,Integer&gt;&gt;</code> 的结构。</p>
<p>但这个无所谓，因为出于场景考虑，大概率是要支持分布式的，那就需要引入<code>redis</code>，可这是一个工具包，因为这个工具就引入一个<code>redis</code>的包不太划算，所以定义了这么一个约定接口，不管你用什么存储，<code>memchche</code>，<code>redis</code>，<code>mangodb</code>，只要实现了这几个方法，传入工具中就能完成对应的功能，算是一个变形的策略模式</p>
<p>这些参数都初始化好之后，看下算法的部分，提供三个接口：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断是否允许进行访问，未超过阈值的话才会对某个时间片+1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">allowLimitTimes</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index = locationIndex();</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// cursor不等于index，将cursor设置为index</span></span><br><span class="line">    <span class="keyword">int</span> oldCursor = cursor.getAndSet(index);</span><br><span class="line">    <span class="keyword">if</span> (oldCursor != index) &#123;</span><br><span class="line">        <span class="comment">// 清零，访问量不大时会有时间片跳跃的情况</span></span><br><span class="line">        clearBetween(oldCursor, index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; timeSliceSize; i++) &#123;</span><br><span class="line">        sum += timeWindowSlidingDataSource.getAllocAdoptRecordTimes(i, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 阈值判断</span></span><br><span class="line">    <span class="keyword">if</span> (sum &lt;= threshold) &#123;</span><br><span class="line">        <span class="comment">// 未超过阈值才+1</span></span><br><span class="line">        <span class="keyword">this</span>.timeWindowSlidingDataSource.allocAdoptRecord(index, key);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回平均每秒访问次数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">allowNotLimitPerMin</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index = locationIndex();</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> nextIndex = index + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.timeWindowSlidingDataSource.clearSingle(nextIndex);</span><br><span class="line">    <span class="keyword">int</span> from = index, to  = index;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; windowSize) &#123;</span><br><span class="line">        from += windowSize + <span class="number">1</span>;</span><br><span class="line">        to += <span class="number">2</span> * windowSize;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        from = index - windowSize + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (from &lt;= to)&#123;</span><br><span class="line">        <span class="keyword">int</span> targetIndex = from;</span><br><span class="line">        <span class="keyword">if</span> (from &gt;= timeSliceSize) &#123;</span><br><span class="line">            targetIndex = from - <span class="number">2</span> * windowSize;</span><br><span class="line">        &#125;</span><br><span class="line">        sum += timeWindowSlidingDataSource.getAllocAdoptRecordTimes(targetIndex, key);</span><br><span class="line">        from ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.timeWindowSlidingDataSource.allocAdoptRecord(index, key);</span><br><span class="line">    <span class="keyword">return</span> (sum + <span class="number">1</span>) / windowSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回每秒访问次数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">allowNotLimit</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index = locationIndex();</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// cursor不等于index，将cursor设置为index</span></span><br><span class="line">    <span class="keyword">int</span> oldCursor = cursor.getAndSet(index);</span><br><span class="line">    <span class="keyword">if</span> (oldCursor != index) &#123;</span><br><span class="line">        <span class="comment">// 清零，访问量不大时会有时间片跳跃的情况</span></span><br><span class="line">        clearBetween(oldCursor, index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= timeSliceSize; i++) &#123;</span><br><span class="line">        sum += timeWindowSlidingDataSource.getAllocAdoptRecordTimes(i, key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.timeWindowSlidingDataSource.allocAdoptRecord(index, key);</span><br><span class="line">    <span class="keyword">return</span> sum + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;将fromIndex~toIndex之间的时间片计数都清零</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;极端情况下，当循环队列已经走了超过1个timeSliceSize以上，这里的清零并不能如期望的进行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clearBetween</span><span class="params">(<span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.timeWindowSlidingDataSource.clearBetween(fromIndex, toIndex, timeSliceSize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">locationIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> time = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">int</span>) ((time / timeMillisPerSlice) % timeSliceSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>演示结果就不给大家展示了，刚把一大堆log去掉，然后滑动窗口的这个算法我有点拎不清，如果有更好的办法欢迎给我留言，或者github协作，该项目<a href="https://github.com/RadianceL/el-common-utils" target="_blank" rel="noopener">github</a>地址，对应实现在<code>com.el.common.time.sliding</code>包下</p>
<p>另外<br>感谢博主:  <a href="https://blog.csdn.net/tianyaleixiaowu/article/details/102861254" target="_blank" rel="noopener">tianyaleixiaowu</a>提供的基础思路</p>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Java/">Java</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2020/01/09/Mybatis-elegant-coding/" data-tooltip="Mybatis-elegant-coding" aria-label="PREVIOUS: Mybatis-elegant-coding">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/07/10/Spring-State-Machine/" data-tooltip="Spring State Machine" aria-label="NEXT: Spring State Machine">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Eddie Lee. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2020/01/09/Mybatis-elegant-coding/" data-tooltip="Mybatis-elegant-coding" aria-label="PREVIOUS: Mybatis-elegant-coding">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/07/10/Spring-State-Machine/" data-tooltip="Spring State Machine" aria-label="NEXT: Spring State Machine">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/eddie-personal.jpg" alt="Author&#39;s picture">
        
            <h4 id="about-card-name">Eddie Lee</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br>
                浙江
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-dbd16rvloemmuxdzniplmnxxvwoz24eya9wol0b7vvmlokgqsjivmb8dnscy.min.js"></script>
<!--SCRIPTS END-->

    



    </body>
</html>
